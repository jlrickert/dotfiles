#!/usr/bin/env bash

if test -n "${COMP_LINE}"; then
	n=$((COMP_CWORD + 1))
	script=$(printf '{for(i=%s; i<=NF; i++) printf $i" "; print ""}' $n)
	pre="$(printf "%s" "${COMP_LINE}" | awk "${script}")"

	if [ -n "${pre}" ]; then
		fd .
	else
		fd --glob "*${pre}*"
	fi
	exit 0
fi

files=$*
## FIXME: This breaks if used within another file that uses pipes as well
# if [ ! -t 0 ]; then
# 	files="$(cat)"
# fi

for file in $files; do
	if [ ! -f "$file" ]; then
		continue
	fi

	# loop through each file in $@
	echo "---

Contents of file \`$file\`:

\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`text
$(cat "$file")
\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`\`

"
done
